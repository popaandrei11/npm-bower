stages:
- stage: 'Transform_Bower_to_NPM'
  jobs:
    - job: transform
      steps:
      - task: CmdLine@2
        displayName: 'Transform bower.json to package.json using npx bower-away'
        inputs:
          script: |
            # Ensure npx is installed
            npm install -g npx

            # Transform bower.json into package.json
            npx bower-away

            # Install npm dependencies and generate package-lock.json with lockfile version 3
            npm install --lockfile-version 3 --package-lock-only --force

      - task: CmdLine@2
        displayName: 'Configure Git'
        inputs:
          script: |
            git config user.email "your-email@example.com"
            git config user.name "Your Name"

      - task: CmdLine@2
        displayName: 'Pull latest changes'
        inputs:
          script: |
            git pull origin master

      - task: CmdLine@2
        displayName: 'Commit package.json and package-lock.json'
        inputs:
          script: |
            git add package.json package-lock.json
            git commit -m "Transform bower.json to package.json and generate package-lock.json"

      - task: CmdLine@2
        displayName: 'Push changes'
        inputs:
          script: |
            git push origin HEAD:master